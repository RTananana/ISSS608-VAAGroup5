<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Tan Yu Yan Rachel, Yap Pin Yaw, Abhishek Singh">
<meta name="dcterms.date" content="2023-05-16">

<title>ISSS608-VAAGroup5 - Project Proposal</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">ISSS608-VAAGroup5</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./proposal.html" rel="" target="" aria-current="page">
 <span class="menu-text">Project Proposal</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://group5vaaapr23.shinyapps.io/shinyapp/" rel="" target="">
 <span class="menu-text">RShiny App</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Group5_Userguide.pdf" rel="" target="">
 <span class="menu-text">User Guide</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">1. Introduction</a></li>
  <li><a href="#background-motivation" id="toc-background-motivation" class="nav-link" data-scroll-target="#background-motivation">2. Background &amp; Motivation</a></li>
  <li><a href="#data-description" id="toc-data-description" class="nav-link" data-scroll-target="#data-description">3. Data Description</a>
  <ul class="collapse">
  <li><a href="#nodes-attributes" id="toc-nodes-attributes" class="nav-link" data-scroll-target="#nodes-attributes">3.1 Nodes Attributes</a></li>
  <li><a href="#edges-attributes" id="toc-edges-attributes" class="nav-link" data-scroll-target="#edges-attributes">3.2 Edges Attributes</a></li>
  </ul></li>
  <li><a href="#analytical-methodology" id="toc-analytical-methodology" class="nav-link" data-scroll-target="#analytical-methodology">4. Analytical Methodology</a>
  <ul class="collapse">
  <li><a href="#packages-to-be-used" id="toc-packages-to-be-used" class="nav-link" data-scroll-target="#packages-to-be-used">4.1 Packages to be used</a></li>
  <li><a href="#exploratory-data-analysis-eda" id="toc-exploratory-data-analysis-eda" class="nav-link" data-scroll-target="#exploratory-data-analysis-eda">4.2 Exploratory Data Analysis (EDA)</a></li>
  <li><a href="#network-graph" id="toc-network-graph" class="nav-link" data-scroll-target="#network-graph">4.3 Network Graph</a></li>
  <li><a href="#clustering-analysis" id="toc-clustering-analysis" class="nav-link" data-scroll-target="#clustering-analysis">4.4 Clustering Analysis</a></li>
  </ul></li>
  <li><a href="#storyboard" id="toc-storyboard" class="nav-link" data-scroll-target="#storyboard">5. Storyboard</a>
  <ul class="collapse">
  <li><a href="#uncovering-the-anomalies" id="toc-uncovering-the-anomalies" class="nav-link" data-scroll-target="#uncovering-the-anomalies">5.1 Uncovering the Anomalies</a></li>
  <li><a href="#grouping-commonalities-uncovering-patterns" id="toc-grouping-commonalities-uncovering-patterns" class="nav-link" data-scroll-target="#grouping-commonalities-uncovering-patterns">5.2 Grouping Commonalities &amp; Uncovering Patterns</a></li>
  <li><a href="#evaluation" id="toc-evaluation" class="nav-link" data-scroll-target="#evaluation">5.3 Evaluation</a></li>
  </ul></li>
  <li><a href="#project-timeline-task-allocation" id="toc-project-timeline-task-allocation" class="nav-link" data-scroll-target="#project-timeline-task-allocation">6. Project Timeline &amp; Task Allocation</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Project Proposal</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Tan Yu Yan Rachel, Yap Pin Yaw, Abhishek Singh </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 16, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="introduction" class="level1">
<h1>1. Introduction</h1>
<p>Fish and other seafood provides nutrients for more than three billion people globally and is an income source for 10%-12% of the world’s population (The Nature Conservancy, 2021). Food and Agriculture Organization of the United Nations (FAO) reports that Illegal, Unreported, and Unregulated (IUU) fishing represents up to 26 million tonnes of fish caught annually (FAO, 2023). IUU remains one of the greatest global threats as it results in overfishing, which threatens marine biodiversity, livelihoods, aggravates poverty, and increases food insecurity (IMO, 2019). Given the global impact that IUU causes, there has been international efforts to account for IUU fishing and a call-to-action to fight IUU. As part of the efforts, Agreement on Port State Measures (PSMA) was instituted in Jun 2016, which is the first binding international agreement specifically designed to prevent, deter and eliminate IUU fishing by denying port access and use to foreign vessels engaging in or supporting such fishing (FAO, 2023). By 2022, 60% of global port states are committed to PSMA (Responsible Seafood Advocate, 2022). Given the global participation, data points have been made available through Global Information Exchange System (GIES) which can be leveraged on to produce data-driven analysis for trend indicators of IUU and gaps identified to tighten IUU measures. Currently, there exists a IUU Fishing Index that provides a measure of the degree to which states are exposed to and effectively combat IUU fishing. The score map allows for oversight on the state-of-health for each region (IUU Fishing Index, 2023).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://iuufishingindex.net/about"><img src="images/Score Map.PNG" class="img-fluid figure-img"></a></p>
<figcaption class="figure-caption">Score Maps</figcaption>
</figure>
</div>
</section>
<section id="background-motivation" class="level1">
<h1>2. Background &amp; Motivation</h1>
<p>This project is motivated by the pressing need to address illegal fishing and protect marine species affected by it. The extraction of entity names and relationships from online news articles related to fishing, marine industry, and international maritime trade using a natural language processing tool provides valuable information for investigation. However, effectively exploring and understanding the context surrounding each tip is challenging without overwhelming analysts with excessive information. Therefore, the motivation is to develop visual analytics techniques that enable analysts to efficiently identify companies potentially involved in illegal fishing. The proposed solution should prioritize displaying relevant contextual information while concealing irrelevant details, while also promoting dynamic and interactive visualization for improved investigative capabilities. By providing a powerful visual tool, this project aims to empower analysts in escalating their investigations and effectively combating illegal fishing practices.</p>
</section>
<section id="data-description" class="level1">
<h1>3. Data Description</h1>
<p>The dataset has:</p>
<ul>
<li><p>27,622 nodes</p></li>
<li><p>24,038 edges</p></li>
<li><p>7,794 connected components</p></li>
</ul>
<p>The dataset given is an undirected multi-graph.</p>
<section id="nodes-attributes" class="level2">
<h2 class="anchored" data-anchor-id="nodes-attributes">3.1 Nodes Attributes</h2>
<table class="table">
<colgroup>
<col style="width: 14%">
<col style="width: 8%">
<col style="width: 76%">
</colgroup>
<thead>
<tr class="header">
<th>Column Name</th>
<th>Data Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>type</td>
<td>character</td>
<td>Type of node that is a company or person.</td>
</tr>
<tr class="even">
<td>country</td>
<td>character</td>
<td>Country associated with the entity. This can be a full country or a two-letter country code.</td>
</tr>
<tr class="odd">
<td>product_services</td>
<td>character</td>
<td>Description of product services that the “id” node does.</td>
</tr>
<tr class="even">
<td>revenue_omu</td>
<td>integer</td>
<td>Operating revenue of the “id” node in Oceanus Monetary Units.</td>
</tr>
<tr class="odd">
<td>id</td>
<td>character</td>
<td>Identifier of the node is also the name of the entry.</td>
</tr>
<tr class="even">
<td>role</td>
<td>character</td>
<td>The subset of the “type” node, includes beneficial owner or company contacts</td>
</tr>
</tbody>
</table>
</section>
<section id="edges-attributes" class="level2">
<h2 class="anchored" data-anchor-id="edges-attributes">3.2 Edges Attributes</h2>
<table class="table">
<colgroup>
<col style="width: 12%">
<col style="width: 10%">
<col style="width: 76%">
</colgroup>
<thead>
<tr class="header">
<th>Column Name</th>
<th>Data Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>type</td>
<td>character</td>
<td>Type of edge that is a person.</td>
</tr>
<tr class="even">
<td>source</td>
<td>character</td>
<td>ID of the source node.</td>
</tr>
<tr class="odd">
<td>target</td>
<td>character</td>
<td>ID of the target node.</td>
</tr>
<tr class="even">
<td>role</td>
<td>character</td>
<td>The subset of the “type” edge, includes beneficial owner or company contacts</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="analytical-methodology" class="level1">
<h1>4. Analytical Methodology</h1>
<section id="packages-to-be-used" class="level2">
<h2 class="anchored" data-anchor-id="packages-to-be-used">4.1 Packages to be used</h2>
<table class="table">
<colgroup>
<col style="width: 7%">
<col style="width: 92%">
</colgroup>
<thead>
<tr class="header">
<th>Package</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>jsonlite</td>
<td>To import nodes and edges data from json format files</td>
</tr>
<tr class="even">
<td>tidygraph</td>
<td>Allow users to manipulate and analyze network graphs using a tidy data framework.</td>
</tr>
<tr class="odd">
<td>ggraph</td>
<td>Provides various options for creating aesthetically pleasing and informative network visualizations</td>
</tr>
<tr class="even">
<td>visNetwork</td>
<td>Enabling the creation of interactive network graphs, provides features like zooming, panning, and tooltips for enhanced exploration of the graph</td>
</tr>
<tr class="odd">
<td>graphlayouts</td>
<td>Provides various layout algorithms for arranging nodes and edges in a network graph, offers different algorithms such as Fruchterman-Reingold, Kamada-Kawai, and more</td>
</tr>
<tr class="even">
<td>ggforce</td>
<td>Extends the functionality of ggplot2 and provides additional geoms, scales, and utilities for creating advanced and customized network visualizations</td>
</tr>
<tr class="odd">
<td>tidytext</td>
<td>Used for text mining and analysis, allows users to work with text data associated with network nodes or edges</td>
</tr>
<tr class="even">
<td>tidyverse</td>
<td>Provides a cohesive and consistent set of tools for data manipulation, visualization, and analysis, which can be utilized in the process of constructing network graphs</td>
</tr>
</tbody>
</table>
</section>
<section id="exploratory-data-analysis-eda" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-data-analysis-eda">4.2 Exploratory Data Analysis (EDA)</h2>
<p>EDA is a crucial step in understanding the dataset by utilizing data visualization techniques. It serves to identify any issues or anomalies within the data and uncover valuable insights about the relationships between variables and underlying patterns present in the dataset. By employing a combination of univariate, bivariate, and multivariate visualizations, as well as summary statistics, a comprehensive understanding of the dataset can be gained.</p>
<p>EDA also plays a significant role in examining the distribution of existing entities within the dataset. By analyzing the type and country data, it becomes possible to discern and comprehend the distinct patterns exhibited by suspicious entities compared to those categorized as non-suspicious.</p>
<p>Through EDA, the team hope to uncover potential data quality issues, detect outliers, identify missing values, and verify the consistency of the dataset. Furthermore, it enables the exploration of correlations, trends, and dependencies between variables, shedding light on hidden insights that might inform further analysis or investigative efforts.</p>
<p>By conducting a thorough EDA, the team can gain a holistic understanding of the dataset, discover meaningful patterns, and generate valuable knowledge that aids decision-making and subsequent analysis tasks.</p>
</section>
<section id="network-graph" class="level2">
<h2 class="anchored" data-anchor-id="network-graph">4.3 Network Graph</h2>
<p>Network graphs, along with centrality measures, provide a powerful tool for identifying potential illegal fishing activities. By constructing a network graph based on relationships and interactions among entities involved in fishing and maritime trade, we can analyze the centrality measures of these entities. Centrality measures, such as degree centrality, betweenness centrality, and eigenvector centrality, allow us to assess the relative importance and influence of each entity within the network. In the context of illegal fishing, entities with high centrality scores may indicate key players or hubs that are potentially involved in illegal activities. By focusing on these influential entities and their connections, we can uncover hidden patterns, detect suspicious relationships, and identify clusters of entities that exhibit abnormal behavior. Network graph analysis, combined with centrality measures, provides a valuable approach to pinpoint potential illegal fishing activities and target further investigation and intervention efforts effectively.</p>
</section>
<section id="clustering-analysis" class="level2">
<h2 class="anchored" data-anchor-id="clustering-analysis">4.4 Clustering Analysis</h2>
<p>By leveraging the available data, specifically the source, target, type of business, country, product description, and value of goods, we can employ clustering analysis on the network graph to identify anomalies that could indicate a company’s involvement in illegal, unreported, and unregulated (IUU) fishing activities.</p>
<p>Clustering algorithms can be applied to group entities based on their connections and relationships in the network graph. By examining the patterns and groupings that emerge, we can identify clusters of entities that exhibit unusual behavior or deviate from the typical characteristics of legitimate fishing operations. These anomalies may manifest as suspicious trade relationships, atypical product descriptions, unexpected transaction values, or unusual combinations of countries and business types.</p>
<p>The clustering analysis enables us to uncover hidden patterns and structures within the data, allowing us to identify entities that demonstrate suspicious or potentially illegal fishing practices. By pinpointing these anomalies, we can prioritize our investigation efforts and allocate resources effectively to combat IUU fishing. This approach provides a data-driven means of detecting and monitoring potential IUU activities, helping to protect marine ecosystems and enforce regulations in the fishing industry.</p>
</section>
</section>
<section id="storyboard" class="level1">
<h1>5. Storyboard</h1>
<section id="uncovering-the-anomalies" class="level2">
<h2 class="anchored" data-anchor-id="uncovering-the-anomalies">5.1 Uncovering the Anomalies</h2>
<p>With EDA, we will be able to have a good overview of the various categories of data, as well and spot any anomaly data through visualizations.</p>
<p>As our dataset is mainly categorical data, our initial data visualizations will be mainly using barcharts and heatmaps.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/barchart example.png" class="img-fluid figure-img" width="346"></p>
<figcaption class="figure-caption">Barchart Example [https://ggplot2.tidyverse.org]</figcaption>
</figure>
</div>
<p>As an additional analysis, we may use mosaic plots to visualize relationships between multiple categorical variables, which can help reveal associations ro dependencies among the variables and help spot unusal patterns or outliers.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mosiac plot example.png" class="img-fluid figure-img" width="636"></p>
<figcaption class="figure-caption">Mosaic Plot Example [Jun 13, 2017 by Achim Zeileis]</figcaption>
</figure>
</div>
</section>
<section id="grouping-commonalities-uncovering-patterns" class="level2">
<h2 class="anchored" data-anchor-id="grouping-commonalities-uncovering-patterns">5.2 Grouping Commonalities &amp; Uncovering Patterns</h2>
<p>Next, we will use network graphs to visualize common groups.</p>
<p>Network analysis will be conducted using the following methods:</p>
<ol type="1">
<li>Community detection through the visualization layout of the network graph.</li>
<li>Node similarity measures using jaccard or cosine similarity to identify companies with common attributes or similar connectivity patterns.</li>
<li>Centrality measures: to use the appropriate centrality measures to identify companies that are highly connected or influential in the network - which would point out potential IUU hubs.</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Network Example.png" class="img-fluid figure-img" width="570"></p>
<figcaption class="figure-caption">Example of Network Communities [June 12, 2019 by Niklas Junker]</figcaption>
</figure>
</div>
</section>
<section id="evaluation" class="level2">
<h2 class="anchored" data-anchor-id="evaluation">5.3 Evaluation</h2>
<p>Grouped together with the various analysis of outlier detection and community detection, the conclusion will identify entities that exhibit suspicious behavior or are disconnected from the rest of the network.</p>
<p>The team will evaluate the evidence presented by the network graph, incorporating external supporting literature reviews to assess the overall credibility and significance of the findings.</p>
</section>
</section>
<section id="project-timeline-task-allocation" class="level1">
<h1>6. Project Timeline &amp; Task Allocation</h1>
<p>To ensure the project tasks are fulfilled the following timeline and task allocation will be adopted.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/gnatt_chart.PNG" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Gantt Chart for Group 5</figcaption>
</figure>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>